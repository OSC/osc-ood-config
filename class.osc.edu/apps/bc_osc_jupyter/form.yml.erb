<%- 

  groups = OodSupport::Process.groups.map(&:name)
  staff = groups.include?('oscall')

  base_modules = "project/classes"

  group_lookup = {
    "BIOCHEM 5721"     => "PAS1745",
    "PHYSICS 6820"     => "PAS1759",
    "OSC JUPYTER"      => "oscall", #not really required, but kept to avoid confusion
    "PHYSICS 280 WIT"  => "PWIT0412"
  }.select { |k,v| groups.include?(v) }

  classes = {
    "BIOCHEM 5721"     => "#{base_modules} class/BIOCHEM5721",
    "PHYSICS 6820"     => "#{base_modules} class/PHYSICS6820",
    "OSC Jupyter"      => "#{base_modules} class/OSCJUPYTER",
    "PHYSICS 280 WIT"  => "#{base_modules} class/PHYS280_WIT"
  }.select { |k,v| group_lookup.has_key?(k) || staff }

-%>
---
cluster: "owens"
form:
  - version
  - jupyterlab_switch
  - bc_num_hours
  - project
  - node_type
  - num_cores
  - staff
  - classroom
attributes:
  node_type: "any"
  classroom: 1
  jupyterlab_switch:
    widget: "check_box"
    label: "Use JupyterLab instead of Jupyter Notebook?"
  num_cores:
    widget: "number_field"
    label: "Number of cores"
    value: 1
    min: 0
    max: 28
    step: 1
  <%- if classes.empty? -%>
  version: "app_jupyter/2.1.4"
  <%- else -%>
  version:
    widget: "select"
    label: "Class Materials"
    options:
    <%- classes.each do |class_name, class_modules| -%>
      - [ "<%= class_name %>", "<%= class_modules %>" ]
    <%- end -%>
    required: true
    html_options:
      data-custom: 
        "with spaces": "value"
  <%- end -%>
  staff:
    widget: "check_box"
    checked_value: <%= staff ? "1" : "0" %>
submit: submit.yml.erb
