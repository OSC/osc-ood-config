<%-

  groups = OodSupport::Process.groups.map(&:name)
  staff = groups.include?('oscall')

  new_modules = "project/classes"
  old_modules = "gnu/7.3.0 mkl/2018.0.3 R/3.6.0 rstudio/1.1.380_server texlive project/classes"

  group_lookup = {
    "STAT 2480"            => "PAS1758",
    "STAT 3202"            => "PAS1644",
    "STAT 5730"            => "PAS1642",
    "ANTHRO 9982"          => "PAS1723",
    "TDAI Workshop"        => "PAS1732",
    "OSC Workshop"         => "PZS0687",
    "OSC RNA-Seq Workshop" => "PZS1010",
    "PUBHLTH 5015"         => "PAS1754",
    "BANA 7025"            => "PES0835",
    "UC Workshop"          => "PES0836",
    "BANA 4090"            => "PES0834",
  }.select { |k,v| groups.include?(v) }

  # only include options if you're in that project
  # or cheat for staff
  classes = {
    "STAT 2480"            => "#{new_modules} class/STAT2480",
    "STAT 3202"            => "#{old_modules} class/STAT3202",
    "STAT 5730"            => "#{old_modules} class/STAT5730",
    "ANTHRO 9982"          => "#{new_modules} class/ANTHROP9982",
    "TDAI Workshop"        => "#{new_modules} class/TDAI",
    "OSC Workshop"         => "#{new_modules} class/OSCWORKSHOP",
    "OSC RNA-Seq Workshop" => "#{new_modules} class/OSCRNASEQ",
    "PUBHLTH 5015"         => "#{new_modules} class/PUBHLTH5015",
    "BANA 7025"            => "#{new_modules} class/BANA7025_UC",
    "UC Workshop"          => "#{new_modules} class/RWORKSHOP_UC",
    "BANA 4090"            => "#{new_modules} class/BANA4090_UC",
  }.select { |k,v| group_lookup.has_key?(k) || staff }

-%>
---
cluster: "owens"
form:
  - version
  - bc_num_hours
  - node_type
  - num_cores
  - project
  - include_tutorials
  - staff
attributes:
  num_cores:
    widget: "number_field"
    label: "Number of cores"
    value: 1
    min: 1
    max: 28
    step: 1
  node_type: "any"
  <%- if  classes.empty? -%>
  version: "gnu/7.3.0 mkl/2018.0.3 R/3.6.0 rstudio/1.1.380_server texlive"
  <%- else -%>
  version:
    widget: "select"
    label: "Class Materials"
    options:
    <%- classes.each do |class_name, class_modules| -%>
      - [ "<%= class_name %>", "<%= class_modules %>", data-option-for-owens: true ]
    <%- end -%>
    required: true
  <%- end -%>
  include_tutorials: "0"
  staff:
    widget: "check_box"
    checked_value: <%= staff ? "1" : "0" %>
submit: submit.yml.erb
